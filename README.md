# Плейлисты Rutube
Плейлист Rutube - встраиваемый виджет, позволяющий воспроизводить предопределенный набор роликов с сайта [rutube.ru](http://rutube.ru) на сторонних ресурсах. Создать плейлист Rutube и разместить его на своем сайте или блоге может любой пользователь интернета.

![alt tag](https://github.com/igorpetrov/RutubePlaylist/blob/master/playlist.png)

## Содержание
1. Общие сведения
2. Шаблон плейлиста
3. Параметры плейлиста
4. Ширина и высота плейлиста

## Общие сведения
Плейлист Rutube - встраиваемый виджет, который позволяет размещать контент Rutube на сторонних сайтах, включая сериалы и передачи каналов ТНТ, Пятница, РЕН-ТВ, мульфильмы производства Союзмульфильм и Disney, множество другого лицензионного контента, а также ролики любого пользователя сайта [rutube.ru](http://rutube.ru). Плейлист может работать на любой площадке, которая разрешает использование тега `<iframe>`: сайты, форумы, блоги. Для размещения плейлиста достаточно разместить код для встраивания, в котором будут указаны необходимый набор роликов, а также ширина и высота плейлиста. Опционально, для интеграции плейлиста с дизайном сайта можно задать ему собственную цветовую схему.

## Шаблон плейлиста
Код для встраивания плейлиста представляет собой HTML-тег `<iframe>`, который ссылается на страницу на сайте rutube.ru. Шаблон кода для встраивания плейлиста выглядит следующим образом:
```html
<iframe width="680px" height="508px" src="http://rutube.ru/playlist/?playlist=" frameborder="0" scrolling="no" mozallowfullscreen webkitallowfullscreen allowfullscreen></iframe>
```

где:

`width` - ширина плейлиста;

`height` - высота плейлиста;

`src` - адрес специальной страницы на сайте rutube.ru, которая отображает плейлист;

`frameborder` - ширина рамки тега `<iframe>` (указывается "ноль" для ее скрытия);

`scrolling` - скрытие полос прокрутки тега `<iframe>`;

`mozallowfullscreen`, `webkitallowfullscreen`, `allowfullscreen` - инструкции, разрешающие роликам из плейлиста разворачиваться на полный экран.

По-сути, этот готовый шаблон уже может быть встроен на сайт, однако, в нем будет отсутствовать контент, и на месте плейлиста пользователи увидят пустое пространство. Для отображения контента необходимо передать в атрибут `src` дополнительные параметры.

## Параметры плейлиста
Параметры, определящие что именно будет отображаться в плейлисте, передаются ему в виде пар `"ключ": "значение"`, перечисляемым через запятую. Такой формат записи параметров известен как [JSON](https://ru.wikipedia.org/wiki/JSON).

Пример записи параметров в формате JSON:
```json
{ "id": "123", "name": "John" }
```
или в более удобной форме:
```json
{
    "id": "123",
    "name": "John"
}
```
В этом примере двум вымышленным параметрам с названиями `"id"` и `"name"` присваиваются значения `"123"` и `"John"` соотвественно.

Кроме простых значений, вроде `"John"`, параметрам можно передавать _списки_. Для этого элементы списка необходимо перечислить через запятую и заключить в квадратные скобки:
```json
{
    "id": "123",
    "names": [ "John", "Jack", "Mary" ]
}
```
или в более удобной форме:
```json
{
    "id": "123",
    "names": [
        "John",
        "Jack",
        "Mary"
    ]
}
```
Здесь параметру `"names"` передается список из имен `"John"`, `"Jack"`, `"Mary"`.

В списках, в свою очередь, помимо простых значений вроде `"John"`, можно также передавать пары `"ключ": "значение"`:
```json
{
    "id": "123",
    "names": [
        { "name": "John", "gender": "male" },
        { "name": "Jack", "gender": "male" },
        { "name": "Mary", "gender": "female" }
    ]
}
```
Именно в таком формате - через списки пар `"ключ": "значение"` - передаются параметры для плейлиста Rutube.

Для описания источников, которые будут использованы в плейлисте, используется следующая форма записи:
```json
{
    "id": "28",
    "type": "tv"
}
```
где:

`"id"` - id источника;

`"type"` - тип источника.

Опционально, вместе с источником можно передать параметр `"name"`, в котором можно указать его альтернативное название:
```json
{
    "id": "28",
    "type": "tv",
    "name": "Мой любимый сериал Интерны"
}
```

В данный момент для использования в плейлистах доступно четыре типа источников:

`"tv"` - ТВ-шоу;

`"person"` - персоны;

`"tag"` - теги;

`"user"` - пользователи.

Минимальным требованием для отображения плейлиста является передача хотя бы одного источника в списке `"feeds"`:
```json
{
    "feeds": [
        { "id": "28", "type": "tv" }
    ]
}
```

В данном случае в плейлист будет передан сериал "Интерны", и лента плейлиста будет состоять из роликов этого сериала.

Полученные параметры необходимо закодировать через [специальный конвертер](http://www.freeformatter.com/url-encoder.html) или его аналоги, либо используя метод `encodeURIComponent` из JavaScript. Для предыдущего примера результат кодирования будет выглядеть следующим образом:
```
%7B%22feeds%22%3A%5B%7B%22id%22%3A%2228%22%2C%22type%22%3A%22tv%22%7D%5D%7D
```

Здесь не стоит пугаться обилия символов вроде `%` - это лишь безопасный формат записи специальных символов, где `%7B` соответствует скобке `{`, `%22` соответвует кавычкам `"` и так далее.

Полученный результат необходимо добавить к атрибуту `src` в шаблоне плейлиста (сразу после `playlist=`):
```html
<iframe width="680px" height="508px" src="http://rutube.ru/playlist/?playlist=%7B%22feeds%22%3A%5B%7B%22id%22%3A%2228%22%2C%22type%22%3A%22tv%22%7D%5D%7D" frameborder="0" scrolling="no" mozallowfullscreen webkitallowfullscreen allowfullscreen></iframe>
```

**После добавления закодированных параметров плейлист становится работоспособным и может быть размещен на сайте.**

Однако, для наилучшей интеграции с сайтом плейлисту желательно задать подходящую ширину и высоту, речь о которых пойдет ниже.

Для создания плейлиста, содержащим несколько источников, необходимо добавить их к списку `"feeds"` через запятую:
```json
{
    "feeds": [
        { "id": "28", "type": "tv" },
        { "id": "1368", "type": "tv" }
    ]
}
```

В этом примере будет создан плейлист с сериалами "Интерны" и "Физрук". Кроме того, теперь в плейлисте будет отображаться меню вкладок, в котором можно выбрать конкретный сериал. Меню появляется автоматически, когда в плейлисте содержится больше одного источника.

Помимо этого, источники поддерживают несколько дополнительных параметров, которые можно передавать в необязательном параметре `"params"`:
```json
{
    "feeds": [{
        "id": "28",
        "type": "tv",
        "name": "Интерны. Все серии"
    }, {
        "id": "28",
        "type": "tv",
        "name": "Интерны. Сезон 1",
        "params": {
            "season": "1"
        }
    }, {
        "id": "1368",
        "type": "tv",
        "name": "Интерны. Сезон 2",
        "params": {
            "season": "2"
        }
    }]
}
```

В этом примере будет создан плейлист с тремя вкладками, содержащими все серии сериала "Интерны", а так же первый и второй сезоны на отдельных вкладках.

Дополнительные параметры:

`"sort"` - сортировка роликов в ленте. Параметр `"sort"` могут принимать источники типов `"tv"` и `"tag"`. Сортировка для источников `"tv"` может принимать значения `"series_a"`, `"series_d"`, `"created_a"`, `"created_d"`, `"publication_a"`, `"publication_d"`. Источники типа `"tag"` принимают значения сортировки `"tagged_a"`, `"tagged_d"`, `"created_a"`, `"created_d"`, `"publication_a"`, `"publication_d"`;

`"ordering"` - сортировка, которую могут принимать источники типа `"user"`. Возможные значения: `"publication_ts`", `"created_ts"`, `"views"`, `"id"`, а также обратные значения этих полей с подстановкой тире: `"-created_ts"`. Также можно комбинировать параметры через запятую, например, `"-created_ts,-id"`;

`"origin__type"` - фильтр ленты, возвращающий ролики принадлежащие конкретному видеохостингу. Возможные значения - `"rtb"`, `"now"`, `"ytb"`, `"vim"`.

Дополнительные параметры, которые можно передать источнику типа `"tv"`:

`"season"` - номер сезона ТВ-шоу;

`"episode"` - номер эпизода ТВ-шоу;

`"type"` - тип связи видео с ТВ-шоу. Принимает значения, актуальный список которых можно посмотреть в [соответствующем API Rutube](http://rutube.ru/api/metainfo/contenttvstype/?format=api).

Также в плейлисте есть возможность включить автоматический старт следующего ролика, передав ему параметр `"rotate"`:
```json
{
    "rotate": "true",
    "feeds": [
        { "id": "28", "type": "tv" },
        { "id": "1368", "type": "tv" }
    ]
}
```

Для наилучшей интеграции с дизайном сайта элементам плейлиста можно задавать собственные цвета. Для этого используется отдельный набор параметров:
```json
{
    "background": "FF0000",
    "feeds": [
        { "id": "28", "type": "tv" },
        { "id": "1368", "type": "tv" }
    ]
}
```

В этом примере плейлисту с помощью параметра `"background"` будет задан красный цвет фона. Все цвета в параметрах передаются в HEX-формате, содержащем шесть символов. Для выбора цвета можно воспользоваться [соответствующим сервисом](http://colorpicker.com) или аналогами.

Список параметров, задающих цвета, выглядит следующим образом:

`"background"` - цвет фона плейлиста;

`"menu_background"` - цвет фона меню;

`"feed_background"` - цвет фона ленты роликов;

`"border_color"` - цвет рамки;

`"text_color"` - цвет текста;

`"elements_color"` - цвет элементов управления (пункты меню, стрелки).

Пример плейлиста, содержащего полный список параметров брендирования:
```json
{
    "background": "FF0000",
    "background": "CCCCCC",
    "menu_background": "000000",
    "feed_background": "0000FF",
    "border_color": "FFEA00",
    "text_color": "00FF08",
    "elements_color": "FF6600",
    "rotate": "true",
    "feeds": [
        { "id": "28", "type": "tv" },
        { "id": "1368", "type": "tv" }
    ]
}
```

Код для встравивания, содержащий закодированные параметры из примера выше:
```html
<iframe width="680px" height="508px" src="http://rutube.ru/playlist/?playlist=%7B%22background%22%3A%22FF0000%22%2C%22background%22%3A%22CCCCCC%22%2C%22menu_background%22%3A%22000000%22%2C%22feed_background%22%3A%220000FF%22%2C%22border_color%22%3A%22FFEA00%22%2C%22text_color%22%3A%2200FF08%22%2C%22elements_color%22%3A%22FF6600%22%2C%22rotate%22%3A%22true%22%2C%22feeds%22%3A%5B%7B%22id%22%3A%2228%22%2C%22type%22%3A%22tv%22%7D%2C%7B%22id%22%3A%221368%22%2C%22type%22%3A%22tv%22%7D%5D%7D" frameborder="0" scrolling="no" mozallowfullscreen webkitallowfullscreen allowfullscreen></iframe>
```

## Ширина и высота плейлиста
Для наилучшей интеграции с дизайном сайта плейлистам можно задавать произвольные размеры. Но при этом необходимо помнить, что высота зависит от ширины, и наоборот.

В большинстве случаев, необходимо сначала узнать ширину блока, в который встраивается плейлист, а затем рассчитать его высоту. Высота, в свою очередь, будет зависить от того, сколько источников передавно в плейлист и будет ли показываться меню.

Если плейлисту передан один источник, то меню будет скрыто. Высота плейлиста в таком случае рассчитывается по формуле (с округлением в большую сторону):
```
H = (W - 22) * 9 / 16 + 96
```

где:

`H` - высота, в пикселях;

`W` - ширина, в пикселях.

Если плейлисту передано больше одного источника, то меню будет показываться. Формула рассчета высоты в таком случае:
```
H = (W - 22) * 9 / 16 + 137
```

После рассчета значения ширины и высоты необходимо подставить в шаблон для вставки плейлиста:
```html
<iframe width="Wpx" height="Hpx" src="..."></iframe>
```

Для примера предположим, что ширина плейлиста должна быть равна `850px` и в плейлисте содержится несколько источников. В этом случае расчет значения высоты будет выглядеть так:
```
H = (850 - 22) * 9 / 16 + 137 = 603
```

Код для вставки с размерами:
```html
<iframe width="850px" height="603px" src="..."></iframe>
```